<html>
    <head>
        <title>Hot Now</title>
        <meta charset="utf-8">
        <!--JQuery로 Ajax하여 읽어오기 위해 import-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> 
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div id = popup>
            <div class = "top_text">
                <p>Today Hot Light Hour</p>
            </div>
            <div class="main"></div>
            <div class = "main_text">
                <p><span>HOT NOW</span> 등의 켜지고 따뜻하고 달콤한 도넛이 나오는 시간입니다.</p>
                <p>현재 <span id="main_t_num">0</span>개의 매장에 <span>HOT NOW</span> 등이 켜졌습니다.</p>
            </div>
            <div class = "day_time_select">
                <div class ="today_time">
                    <h2 id ="today_text">5/11(수)</h2>
                    <h2 class ="date_time_red" id = "date_time_red">00:00</h2>
                </div>
                <div class ="input_time">
                    <form>
                        <select name = "sel_time_li" id = "sel_time_li">
                            <option value="7" selected>7:00</option>
                            <option value="8">8:00</option>
                            <option value="9">9:00</option>
                            <option value="10">10:00</option>
                            <option value="11">11:00</option>
                            <option value="12">12:00</option>
                            <option value="13">13:00</option>
                            <option value="14">14:00</option>
                            <option value="15">15:00</option>
                            <option value="16">16:00</option>
                            <option value="17">17:00</option>
                            <option value="18">18:00</option>
                            <option value="19">19:00</option>
                            <option value="20">20:00</option>
                            <option value="21">21:00</option>
                            <option value="22">22:00</option>
                            <option value="23">23:00</option>
                            <option value="24">24:00</option>
                        </select>
                    </form>
                   <img onclick = "enter_btn_click()" id="enter_btn" src="imges/btn_enter.png" alt="확인버튼">
                </div>
            </div>
            <div id = "noneText"> </div>
            
            <div id = "contents">
                <div id = "sto_photo">
                   <!-- <img id="sto_img" id = "stimg" src = "imges/-.jpg" alt="수원인계점" width="200" height="150"> -->
                </div>
                <div id = "sto_title">
                    <ul id ="ul">
                        <!-- <li class = "sto_tit_text" id ="stname">매장명</li>
                        <li class = "sto_time_text" id ="sttime">영업시간</li>
                        <li><a href=""><img src="imges/btn_go.png" alt ="바로가기버튼"></a></li> -->
                    </ul>
                </div>
            </div>
          
        </div>
        
        <script type="text/javascript">

            var storename = [];
            var storetime = [];
            var storeImgname = [];
            
            let selectTime; //선택한 시간
          
            //오늘 날짜와 현재 시간 출력 
            var today = new Date()
            var current_time = new Date()
            document.getElementById("today_text").innerHTML = ( today.getMonth()+1 +'/'+ today.getDate() )  //오늘날짜
            document.getElementById("date_time_red").innerHTML = (today.getHours() +':'+ today.getMinutes())  //현재시간
            

            function enter_btn_click(){  // 시간 선택 후 확인 버튼 클릭시 실행
                select_val = document.getElementsByName("sel_time_li").values;
                console.log(Boolean(select_val));
                console.log(Boolean(document.getElementById('stimg')));

                
                if(Boolean(document.getElementById('stimg'))=== true){
                    DeleteStoreInfo();
                    console.log(  'in dddd');
                }
                
                sel_time_li()
            }

            function sel_time_li(){  //선택한 시간이 text에 출력
                
                var forms = document.forms[0];
                document.getElementById("date_time_red").innerHTML = forms.sel_time_li.options[forms.sel_time_li.selectedIndex].text;
                selectTime = forms.sel_time_li.options[forms.sel_time_li.selectedIndex].value; //선택시간대 저장
               
                //선택된 시간에 따른 json파일에서 값 출력
                $.getJSON('hotnow_data.json',function(data){
                
                    for(key in data){
                        if(data[key].time == selectTime){ //선택된 시간대
                            if(data[key].store == 'NONE' && Boolean(document.getElementById('noneText_p'))===false){  
                                AddNoneText();  //None text 출력
                            }  
                            else if(data[key].store == 'NONE' && Boolean(document.getElementById('noneText_p'))===true){
                                console.log('none은 한개만');
                            }
                            else{
                                if(Boolean(document.getElementById('noneText_p'))===true){ 
                                    DeleteNoneText(noneText); //None text 삭제
                                }
                                else{
                                    let name = data[key].store; 
                                    storename.push(name);

                                    let time = data[key].times;
                                    storetime.push(time);

                                    let imgname = data[key].imgname;
                                    storeImgname.push(imgname);
                                }
                            }
                        }
                    }
                    for(let i = 0 ; i<storename.length; i++){
                        let sto_count = storename.length;
                        AddStoreInfo(sto_count,storeImgname[i],storename[i],storetime[i]);  //매장명, 영업시간 html 태그 생성
                    }
                });
            }

            //none text 태그 생성 함수
            function AddNoneText(){  
                document.getElementById('main_t_num').innerHTML = 0;
                let noneText = document.createElement("p");
                noneText.innerHTML = 'HOT NOW 등이 켜진 매장이 없습니다.';
                noneText.setAttribute('id','noneText_p');
                noneText.style.color = '#eb1943'; 
                noneText.style.fontSize='13px';
                noneText.style.marginTop='20px';
                noneText.style.textAlign='center';
                document.getElementById('noneText').appendChild(noneText);
            }

           //none text 태그 삭제 함수
           function DeleteNoneText(){ 
               let delNoneText = document.getElementById('noneText_p');
               let parentObj = delNoneText.parentNode;
               parentObj.removeChild(delNoneText);
           }

           //매장 정보 태그 생성 함수
           function AddStoreInfo(sto_count,imgname,name,time){
                document.getElementById('main_t_num').innerHTML = Number(sto_count);

               //----- Image -----
               let storeImg = document.createElement('img');
               storeImg.src = 'imges/'+ imgname +'.jpg'; //이미지 경로
               storeImg.setAttribute('id','stimg');
               
               //css
               storeImg.style.width='200px';
               storeImg.style.height='150px';
               storeImg.style.margin='15px 0 15px 15px';

               document.getElementById('sto_photo').appendChild(storeImg);


               //----- name, time -----
               let stoname = document.createElement('li'); //매장명
               let stotime = document.createElement('li'); //영업시간
               stoname.innerHTML = name; 
               stotime.innerHTML = time;
               stoname.setAttribute('id','stname');
               stotime.setAttribute('id','sttime');

               //css - 매장이름
               stoname.style.color = '#eb1943'; 
               stoname.style.fontSize = '16px';
               stoname.style.padding ="15px 0 0 0";
               
               //css - 영업시간
               stotime.style.fontSize = '13px';
               stotime.style.margin = '10px 0 125px 0'; 

               document.getElementById('ul').appendChild(stoname);
               document.getElementById('ul').appendChild(stotime);
           }

           //매장 정보 태그 삭제 함수
           function DeleteStoreInfo(){
               
               console.log('in??');

               
               /*
               let delStoreImg = document.getElementById('stimg');
               let delStorename = document.getElementById('stname');
               let delStoreInfo = document.getElementById('sttime');

               console.log(delStorename);

               
               let parentObj_img = delStoreImg.parentNode;
               let parentObj_name = delStorename.parentNode;
               let parentObj_time = delStoreInfo.parentNode;
                */

                parentObj_img = document.getElementById('sto_photo');
                parentObj_name = document.getElementById('ul');

                parentObj_img.removeChild();
                parentObj_name.removeChild();
                parentObj_name.removeChild();

                console.log('in......??');
           }
            
          
           /*
           function AddContents(){  //contents영역 태그 복사
               let storeContents = document.getElementById('contents').cloneNode(true);
               document.body.appendChild(storeContents);
               console.log('addContents')
           }
          */
        </script>
    </body>
</html>